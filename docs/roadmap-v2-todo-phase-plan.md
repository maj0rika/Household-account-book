# Roadmap v2: TODO + 페이즈 계획 (2026-02-25)

요청 사항을 기능/리스크 기준으로 정리한 실행 계획서.

---

## 1) 통합 TODO 백로그

## P0 (즉시, UX 체감/오류)
- [x] **TX-01** AI 파싱 결과 편집: 좌측 화살표뿐 아니라 **카드 바디 클릭 시에도 펼침/접힘**
- [x] **TX-02** 금액 입력/표시 포맷: 천단위 `,` 적용 (입력 중/저장 후 모두)
- [x] **TX-03** 월 이동 UX: 이전/다음 월 클릭 시 로딩 상태(프로그레스) 표시
- [x] **TX-04** 월 라벨 클릭 시 월 점프 가능한 팝업 월 피커 제공
- [x] **TX-05** 주간지출 차트 클릭 필터: 클릭한 요일 거래만 목록 표시, 재클릭 시 해제
- [x] **TX-06** 고정지출/수입 영역 아코디언 접기/펼치기
- [x] **TX-07** 카테고리 차트 클릭 → 상세 분석 페이지(`/statistics`) 필터 이동
- [ ] **TX-08** 거래/자산 저장 성공 시 해당 화면으로 명확히 리다이렉트/포커스
- [x] **TX-09** 월 전환 상태와 주간지출(focusDate) 필터 범위 정합성 개선 (과거월에서 최근 7일 필터가 0건처럼 보이는 리스크 해소)

## P1 (성능/로딩 구조)
- [ ] **PF-01** 페이지 전환 성능 개선: 라우팅 프리패치, Server Component 스트리밍, 캐시 정책 재점검
- [ ] **PF-02** Above-the-fold 우선 로딩: 상단 카드/핵심 리스트 우선 렌더, 하단 차트/보조 영역 지연 로딩
- [ ] **PF-03** 차트/무거운 컴포넌트 dynamic import + skeleton
- [ ] **PF-04** 월 전환 시 비관적 전체 블락 대신 부분 로딩(섹션별 pending)
- [ ] **PF-05** 사용자가 "멈춤"으로 느끼지 않게 상태 문구/마이크로 애니메이션 통일

## P2 (AI 파싱/중복/모델 라우팅)
- [ ] **AI-01** 자동 파싱 시 고정 거래(수입/지출) 중복 등록 방지 로직 추가
- [ ] **AI-02** 입력 길이/이미지 유무 기준 모델 라우팅: 짧은 텍스트=Kimi 우선, 긴 텍스트/이미지=고성능 모델
- [ ] **AI-03** 요청 크기별 timeout 차등화 + 사용자 안내 문구("분석 중/정리 중")
- [ ] **AI-04** 긴 요청 처리 UX: 단계형 상태 메시지 + 취소/재시도 UX

## P3 (데이터 모델/도메인 확장)
- [ ] **DM-01** 사용자 거래/자산 데이터 암호화 저장(필드 단위)
- [ ] **DM-02** 자산-거래 연동 모델 설계(계정잔액 변동 반영 규칙)
- [ ] **DM-03** 거래/수입 데이터 timestamp(초 단위) 저장 및 정렬 기준 고도화
- [ ] **DM-04** 고정거래 적용 내역을 "일괄 완료"가 아닌 "개별 적용 항목"으로 분리 표기

## P4 (신규 기능/보안 운영)
- [ ] **AN-01** AI 소비습관 분석 기능(월간 패턴/카테고리 편중/절약 제안)
- [ ] **SEC-01** 악성 사용자 제한: 프롬프트 남용/토큰 소모/공격 패턴 rate limit + 단계별 차단
- [ ] **SEC-02** 입력 안전장치: OOD/프롬프트 인젝션/비정상 payload 방어 강화

---

## 2) 페이즈 실행 계획

### Phase 1 (1주): 인터랙션/체감 UX 고도화
범위: TX-01~TX-08
- 목표: 사용자가 즉시 체감하는 조작성/탐색성 문제 해소
- 산출물: 클릭 UX 개선, 월점프, 차트-필터 연동, 저장 후 리다이렉트 일관성

### Phase 2 (1~2주): 성능/로딩 아키텍처
범위: PF-01~PF-05
- 목표: 페이지 전환 지연 체감 최소화
- 산출물: 섹션별 로딩, 지연 로딩, 프리패치/캐시 최적화, 로딩 카피 가이드

### Phase 3 (1주): AI 파싱 안정성 + 라우팅
범위: AI-01~AI-04
- 목표: 중복 등록 제거 + 긴 요청 UX 안정화
- 산출물: 모델 선택 정책, timeout 정책, 진행 상태 디자인

### Phase 4 (1~2주): 데이터 모델/보안 기반
범위: DM-01~DM-04, SEC-01~SEC-02
- 목표: 저장 데이터 보안/정합성 강화
- 산출물: 암호화 저장 설계, 악성유저 제한, timestamp 정교화

### Phase 5 (1주): 분석 기능 론칭
범위: AN-01
- 목표: 소비습관 인사이트 기능 출시
- 산출물: 분석 카드 + 상세 리포트 + 설명가능한 지표

---

## 3) 기술 메모 (초안)

- 암호화 저장: 앱 레벨 필드 암호화(AES-GCM) + 키는 KMS/시크릿 매니저 분리
- 자산 연동: 거래 생성/수정/삭제 이벤트 시 account balance 증감 반영(옵션: 수동/자동)
- timestamp: `createdAt` 외 `occurredAt`(초 단위) 추가 검토
- 성능: 차트/달력/통계는 lazy + suspense fallback 분리

---

## 4) 확정된 의사결정 (태희 답변 반영)

1. 월 점프 UI: **팝업 방식 채택**
2. 주간지출 클릭 필터: **바텀 차트/하단 전용 흐름으로 처리**
3. 카테고리 차트 클릭 이동: **`/statistics?month=...&category=...` 방식 채택**
4. 저장 후 리다이렉트: 기본은 거래/자산 각각 탭 유지, **혼합 저장 완료 시 거래 탭 유지**
5. 자산-거래 연동: **초기 등록 시 자산 선택 얼럿(선택형) 추가 + DB 저장**
   - 단, 자산 선택 얼럿 노출 정책은 **설정에서 변경 가능**하게 제공
6. 암호화 범위: **잔액(balance)만 우선 암호화**

---

## 5) 최종 확정 사항 (추가)

1. 자산 선택 얼럿 트리거: **1회 기본 노출(1A)** + 설정에서 정책 변경 가능
2. 고정거래 중복 판정: **금액+설명+카테고리+날짜근접(±1일) (2A)**
3. 모델 라우팅 임계치: **짧은 텍스트 100자 이하 (3A-100자)**
4. 악성 유저 제한 단계: **soft 제한부터 시작 (4A)**

---

## 6) 다음 액션 제안

- 확정된 결정 기준으로 **Phase 1 구현 즉시 시작**
- Phase 3에서 모델 라우팅/timeout 정책(100자 임계치) 동시 반영
